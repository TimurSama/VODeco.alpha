# План полной доработки VODeco
## Комплексный план реализации

---

## Содержание
1. [Расширения схемы базы данных](#1-расширения-схемы-базы-данных)
2. [Аутентификация и управление сессиями](#2-аутентификация-и-управление-сессиями)
3. [Реферальная система](#3-реферальная-система)
4. [Интеграция с социальными сетями и вознаграждения](#4-интеграция-с-социальными-сетями-и-вознаграждения)
5. [Система миссий и заданий](#5-система-миссий-и-заданий)
6. [Расчет аирдропов и вознаграждений](#6-расчет-аирдропов-и-вознаграждений)
7. [Улучшение страницы профиля](#7-улучшение-страницы-профиля)
8. [Раздел библиотеки/исследований](#8-раздел-библиотекиисследований)
9. [Система подачи новостей](#9-система-подачи-новостей)
10. [Визуализация дорожной карты](#10-визуализация-дорожной-карты)
11. [Улучшения API](#11-улучшения-api)
12. [Интеграция токеномики](#12-интеграция-токеномики)

---

## 1. Расширения схемы базы данных

### 1.1 Новые модели для добавления

#### Реферальная система
```prisma
model Referral {
  id            String   @id @default(cuid())
  referrerId    String   // Пользователь, создавший реферальную ссылку
  referrer      User     @relation("Referrer", fields: [referrerId], references: [id])
  referredId    String?  // Пользователь, использовавший ссылку (nullable до использования)
  referred      User?    @relation("Referred", fields: [referredId], references: [id])
  code          String   @unique // Уникальный реферальный код
  link          String   @unique // Уникальная реферальная ссылка
  status        String   @default("active") // 'active', 'used', 'expired'
  rewardAmount  String   @default("0") // Вознаграждение для реферера
  createdAt     DateTime @default(now())
  usedAt       DateTime?
  
  @@index([referrerId])
  @@index([referredId])
  @@index([code])
}

// Добавить в модель User:
// referralsCreated Referral[] @relation("Referrer")
// referralsUsed   Referral[] @relation("Referred")
```

#### Публикации в социальных сетях
```prisma
model SocialShare {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id])
  platform      String   // 'twitter', 'facebook', 'telegram', 'linkedin', 'instagram', 'vk'
  postUrl       String   // URL опубликованного поста
  newsPostId    String?  // Если публикуется новостная статья
  newsPost      NewsPost? @relation(fields: [newsPostId], references: [id])
  verified      Boolean  @default(false) // Верификация администратором
  rewardAmount  String   @default("0")
  rewardStatus  String   @default("pending") // 'pending', 'approved', 'rejected'
  metadata      String?  // JSON: скриншот, метрики вовлеченности и т.д.
  createdAt     DateTime @default(now())
  verifiedAt    DateTime?
  
  @@index([userId])
  @@index([platform])
  @@index([rewardStatus])
}
```

#### Миссии и задания
```prisma
model Mission {
  id              String   @id @default(cuid())
  title           String
  description     String
  type            String   // 'task', 'vacancy', 'partnership', 'news_submission'
  category        String   // 'development', 'design', 'marketing', 'content', 'research', 'partnership'
  status          String   @default("active") // 'active', 'completed', 'paused', 'closed'
  rewardAmount    String   // Вознаграждение в VOD токенах
  rewardType      String   // 'fixed', 'variable', 'tiered'
  requirements    String?  // JSON: навыки, опыт, результаты
  maxParticipants Int?     // Для заданий, которые могут выполнить несколько пользователей
  currentParticipants Int  @default(0)
  deadline        DateTime?
  metadata        String?  // JSON: дополнительная информация
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  submissions     MissionSubmission[]
  
  @@index([type])
  @@index([category])
  @@index([status])
}

model MissionSubmission {
  id            String   @id @default(cuid())
  missionId     String
  mission       Mission  @relation(fields: [missionId], references: [id])
  userId        String
  user          User     @relation(fields: [userId], references: [id])
  status        String   @default("pending") // 'pending', 'reviewing', 'approved', 'rejected'
  content       String?  // Текстовая заявка
  attachments   String?  // JSON: URL файлов, изображений, видео
  rewardAmount  String   @default("0")
  feedback      String?  // Обратная связь от администратора
  submittedAt   DateTime @default(now())
  reviewedAt    DateTime?
  
  @@unique([missionId, userId]) // Одна заявка на пользователя на миссию
  @@index([userId])
  @@index([status])
}
```

#### Уровень пользователя и опыт
```prisma
model UserLevel {
  id            String   @id @default(cuid())
  userId        String   @unique
  user          User     @relation(fields: [userId], references: [id])
  level         Int      @default(1)
  experience    Int      @default(0) // Очки опыта (XP)
  totalRewards  String   @default("0") // Всего заработано VOD
  achievements  Int      @default(0) // Количество достижений
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

// Добавить в модель User:
// level UserLevel?
```

#### Элементы библиотеки/исследований
```prisma
model LibraryItem {
  id            String   @id @default(cuid())
  title         String
  description   String
  type          String   // 'research', 'article', 'study', 'publication', 'project_card'
  category      String   // 'water_resources', 'ecology', 'technology', 'policy', 'science'
  authorId      String?
  author        User?    @relation(fields: [authorId], references: [id])
  content       String?  // Полный текст или markdown
  fileUrl       String?  // URL PDF, документа
  imageUrl      String?
  tags          String?  // JSON массив
  published     Boolean  @default(false)
  publishedAt   DateTime?
  views         Int      @default(0)
  likes         Int      @default(0)
  metadata      String?  // JSON: DOI, журнал, цитирования и т.д.
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  comments      Comment[]
  
  @@index([type])
  @@index([category])
  @@index([published])
}

// Добавить в модель Comment:
// libraryItemId String?
// libraryItem   LibraryItem? @relation(fields: [libraryItemId], references: [id])
```

#### Расширенная модель постов
```prisma
// Расширить существующую модель Post:
model Post {
  // ... существующие поля ...
  type          String   @default("post") // 'post', 'news', 'research', 'achievement', 'project_card'
  attachments   String?  // JSON: изображения, видео, аудио, файлы
  tags          String?  // JSON массив
  location      String?  // Опциональное местоположение
  // ... остальные существующие поля ...
}
```

#### События аирдропов
```prisma
model Airdrop {
  id            String   @id @default(cuid())
  name          String
  description   String
  type          String   // 'social_share', 'referral', 'mission', 'news_submission', 'general'
  totalAmount   String   // Всего выделено VOD
  distributedAmount String @default("0")
  startDate     DateTime
  endDate       DateTime?
  criteria      String?  // JSON: требования
  status        String   @default("active") // 'active', 'paused', 'completed'
  createdAt     DateTime @default(now())
  
  distributions AirdropDistribution[]
  
  @@index([type])
  @@index([status])
}

model AirdropDistribution {
  id            String   @id @default(cuid())
  airdropId     String
  airdrop       Airdrop  @relation(fields: [airdropId], references: [id])
  userId        String
  user          User     @relation(fields: [userId], references: [id])
  amount        String
  reason        String   // Причина получения аирдропа
  status        String   @default("pending") // 'pending', 'distributed', 'failed'
  distributedAt DateTime?
  createdAt     DateTime @default(now())
  
  @@index([userId])
  @@index([status])
}

// Добавить в модель User:
// airdropDistributions AirdropDistribution[]
```

---

## 2. Аутентификация и управление сессиями

### 2.1 Реализация JWT
- Заменить демо-режим на JWT-сессии
- Использовать `next-auth` или кастомное JWT-решение
- Хранить сессии в базе данных или Redis

### 2.2 Middleware для API
- Создать middleware для защищенных маршрутов
- Извлекать пользователя из JWT токена
- Обрабатывать обновление токена

### 2.3 Файлы для создания/изменения
- `src/lib/auth/jwt.ts` - Утилиты JWT
- `src/lib/auth/middleware.ts` - Middleware аутентификации
- `app/api/auth/session/route.ts` - Управление сессиями
- Обновить все API маршруты для использования auth middleware

---

## 3. Реферальная система

### 3.1 Функции
- Уникальные реферальные коды для каждого пользователя (автогенерация при регистрации)
- Уникальные реферальные ссылки: `https://vodeco.org/ref/{code}`
- Структура вознаграждений:
  - Реферер: 500-1000 VOD (настраиваемо)
  - Приглашенный: 1000 VOD приветственный бонус (существующий) + 200 VOD реферальный бонус
- Отслеживание использования рефералов и предотвращение саморефералов

### 3.2 API эндпоинты
- `GET /api/referrals` - Получить реферальный код и статистику пользователя
- `POST /api/referrals/use` - Использовать реферальный код (при регистрации)
- `GET /api/referrals/stats` - Статистика рефералов

### 3.3 Реализация
- Изменить `app/api/auth/telegram/route.ts` для принятия параметра `referralCode`
- Создавать реферальный код при создании пользователя
- Автоматически распределять вознаграждения
- Создать компонент дашборда рефералов

---

## 4. Интеграция с социальными сетями и вознаграждения

### 4.1 Поддерживаемые платформы
- Twitter/X
- Facebook
- Telegram
- LinkedIn
- Instagram
- VKontakte (для российского рынка)

### 4.2 Методы верификации
- Ручной: пользователь отправляет скриншот/доказательство
- Автоматический: интеграция OAuth (где возможно)
- Верификация URL: проверка наличия ссылки VODeco в посте

### 4.3 Структура вознаграждений
- Базовое вознаграждение: 50-200 VOD за верифицированную публикацию
- Бонус за вовлеченность: +10-50 VOD за каждые 100 лайков/шаров
- Дневной лимит: максимум 5 публикаций на платформу в день
- Бонус за качество: +100 VOD за вирусные посты (1000+ вовлечений)

### 4.4 API эндпоинты
- `POST /api/social/share` - Отправить публикацию в соцсети
- `GET /api/social/shares` - Получить публикации пользователя
- `POST /api/social/verify/:id` - Верификация администратором
- `GET /api/social/stats` - Статистика публикаций в соцсетях

### 4.5 Компоненты
- Компонент кнопки "Поделиться" с выбором платформы
- Форма верификации публикации
- Дашборд социальных сетей

---

## 5. Система миссий и заданий

### 5.1 Типы миссий

#### A. Вакансии (открытые позиции)
- Frontend разработчик (React/Next.js)
- Backend разработчик (Node.js/TypeScript)
- Blockchain разработчик (Solidity/Web3)
- UI/UX дизайнер
- Маркетолог
- SMM специалист
- Контент-мейкер
- Инфлюенсерская программа
- Партнерская программа
- Исследователь
- Аналитик данных
- Комьюнити-менеджер

#### B. Задания
- Исправление багов
- Разработка функций
- Документация
- Перевод
- Тестирование
- Дизайн-макеты

#### C. Подача новостей
- Предложить релевантные новости о воде/экологии
- Вознаграждение: 20-100 VOD за одобренную заявку

#### D. Партнерства
- Партнерства с компаниями
- Сотрудничество с организациями
- Партнерства с НПО
- Партнерства с правительством

### 5.2 Структура страницы миссий
- Фильтр по типу, категории, статусу
- Функция поиска
- Сортировка по вознаграждению, дедлайну, популярности
- Страница деталей миссии с формой подачи
- Отслеживание прогресса

### 5.3 API эндпоинты
- `GET /api/missions` - Список миссий с фильтрами
- `GET /api/missions/:id` - Детали миссии
- `POST /api/missions/:id/submit` - Подать заявку на миссию
- `GET /api/missions/my-submissions` - Заявки пользователя
- `POST /api/missions/:id/review` - Административный обзор (одобрить/отклонить)

### 5.4 Расчет вознаграждений
- На основе сложности и типа миссии
- Многоуровневые вознаграждения за качественные заявки
- Бонус за раннее выполнение

---

## 6. Расчет аирдропов и вознаграждений

### 6.1 Расчеты на основе токеномики

#### Общий пул аирдропов
- Выделить 5-10% от общего предложения для аирдропов
- Распределить в течение 12-24 месяцев
- Резервные пулы:
  - Публикации в соцсетях: 2%
  - Рефералы: 2%
  - Миссии: 3%
  - Подача новостей: 1%
  - Общее сообщество: 2%

#### Формулы вознаграждений

**Вознаграждения за публикации в соцсетях:**
```
Базовое: 50 VOD
Бонус за вовлеченность: (лайки + шары) / 100 * 10 VOD (макс 50)
Вирусный бонус: если (вовлеченность > 1000) + 100 VOD
Дневной лимит: 5 публикаций/день
Макс на публикацию: 200 VOD
```

**Реферальные вознаграждения:**
```
Реферер: 500 VOD (первые 10 рефералов), 300 VOD (11-50), 200 VOD (51+)
Приглашенный: 200 VOD бонус (в дополнение к 1000 приветственному)
Тировый бонус: +100 VOD если у реферера 10+ активных рефералов
```

**Вознаграждения за миссии:**
```
Вакансия: 500-5000 VOD (в зависимости от роли и сложности)
Задание: 100-2000 VOD (в зависимости от сложности)
Подача новостей: 20-100 VOD (в зависимости от качества и релевантности)
Партнерство: 1000-10000 VOD (в зависимости от ценности партнерства)
```

**Вознаграждения за подачу новостей:**
```
Базовое: 20 VOD
Бонус за качество: +30 VOD (если одобрено и опубликовано)
Бонус за релевантность: +50 VOD (если высоко релевантно водным ресурсам)
Первая подача: +10 VOD бонус
```

### 6.2 Реализация
- Создать `src/lib/tokenomics/rewards.ts` с функциями расчета
- Интегрировать с системой распределения аирдропов
- Автоматическое распределение вознаграждений при одобрении
- Ручной обзор для высокоценных вознаграждений

---

## 7. Улучшение страницы профиля

### 7.1 Новые функции

#### A. Лента достижений
- Хронология всех достижений
- Фильтр по категориям
- Поделиться достижениями
- Отображение значков достижений

#### B. Система уровней пользователя
- Прокачка на основе XP
- Преимущества уровня (выше APY стейкинга, приоритетная поддержка)
- Прогресс-бар уровня
- Требования следующего уровня

#### C. Лента публикаций
- Посты пользователя, подачи новостей, исследования
- Фильтр по типу
- Пустое состояние: "Публикаций пока нет"
- Кнопка создания новой публикации

#### D. Создание контента
- Редактор форматированного текста
- Загрузка медиа (изображения, видео, аудио)
- Прикрепление достижений
- Прикрепление карточек проектов
- Система тегов
- Переключатель публикации/скрытия

#### E. Дашборд статистики
- Всего заработано вознаграждений
- Активные стейкинги
- Количество рефералов
- Количество публикаций в соцсетях
- Завершенные миссии
- Уровень и XP

### 7.2 Компоненты для создания
- `AchievementFeed.tsx`
- `LevelProgress.tsx`
- `PublicationFeed.tsx`
- `ContentEditor.tsx`
- `ProfileStats.tsx`

---

## 8. Раздел библиотеки/исследований

### 8.1 Функции
- Просмотр исследовательских статей, исследований, публикаций
- Фильтр по категории, типу, автору
- Функция поиска
- Просмотр/скачивание документов
- Комментарии и обсуждения
- Подачи пользователей

### 8.2 Структура страниц
- Главная страница библиотеки: `/library`
- Страницы категорий
- Страница деталей элемента
- Форма подачи

### 8.3 API эндпоинты
- `GET /api/library` - Список элементов библиотеки
- `GET /api/library/:id` - Детали элемента
- `POST /api/library` - Подать новый элемент
- `GET /api/library/my-items` - Подачи пользователя

---

## 9. Система подачи новостей

### 9.1 Форма подачи
- Заголовок
- Содержание/Описание
- URL источника
- Выбор категории
- Загрузка изображения
- Теги
- Контактная информация

### 9.2 Процесс обзора
- Очередь административного обзора
- Одобрение/отклонение с обратной связью
- Автоматическое распределение вознаграждений при одобрении
- Оценка качества

### 9.3 Точки интеграции
- Страница миссий: миссия "Подать новость"
- Страница новостей: кнопка "Подать новость"
- Профиль: подачи новостей пользователя

---

## 10. Визуализация дорожной карты

### 10.1 Структура дорожной карты

#### Фаза 1: Основание (Месяцы 0-6)
- Завершение MVP
- Основные функции
- Пользовательская база: 1,000-5,000
- Подготовка к запуску токена

#### Фаза 2: Рост (Месяцы 6-18)
- Реализация DAO
- Цифровые двойники
- Региональное расширение (3-5 регионов)
- Пользовательская база: 10,000-50,000
- Листинг токена (DEX)

#### Фаза 3: Масштабирование (Месяцы 18-36)
- Полное DAO управление
- Инфраструктурные проекты
- Строительство/модернизация станций
- Глобальное расширение
- Пользовательская база: 100,000+
- Листинг токена (CEX)

### 10.2 Визуальные элементы
- Интерактивная временная шкала
- Маркеры вех
- Индикаторы прогресса
- Карта регионального расширения
- Дашборд метрик
- Эволюция технологического стека

### 10.3 Реализация
- Создать страницу `/roadmap`
- Использовать библиотеку интерактивных графиков (Recharts + D3)
- Анимированная временная шкала
- Фильтр по категориям (технологии, бизнес, токеномика)

---

## 11. Улучшения API

### 11.1 Интеграция реальных данных
- Удалить все демо/mock данные
- Обеспечить использование реальных запросов к БД во всех API
- Интегрировать внешние API (World Bank, USGS и т.д.)
- Реализовать стратегию кэширования

### 11.2 Новые API маршруты
```
/api/referrals/*
/api/social/*
/api/missions/*
/api/library/*
/api/airdrop/*
/api/user/level
/api/user/stats
```

### 11.3 Обработка ошибок
- Стандартизированные ответы об ошибках
- Ограничение частоты запросов
- Валидация входных данных
- Логирование

---

## 12. Интеграция токеномики

### 12.1 Модуль расчетов
- Расширить `src/lib/tokenomics/calculations.ts`
- Добавить функции расчета вознаграждений
- Добавить логику распределения аирдропов
- Добавить расчеты уровня/XP

### 12.2 Точки интеграции
- Все распределения вознаграждений
- Расчеты стейкинга
- Прогрессия уровня пользователя
- События аирдропов

---

## Приоритет реализации

### Фаза 1 (Неделя 1-2): Основание
1. Расширения схемы базы данных
2. Аутентификация и управление сессиями
3. Реферальная система (базовая)

### Фаза 2 (Неделя 3-4): Основные функции
4. Система миссий (базовая)
5. Интеграция с социальными сетями (базовая)
6. Улучшения профиля

### Фаза 3 (Неделя 5-6): Продвинутые функции
7. Раздел библиотеки
8. Система подачи новостей
9. Система аирдропов
10. Расчеты вознаграждений

### Фаза 4 (Неделя 7-8): Полировка и запуск
11. Визуализация дорожной карты
12. Улучшения UI/UX
13. Тестирование и исправление багов
14. Документация

---

## Дополнения к технологическому стеку

### Новые зависимости
- `jsonwebtoken` - JWT токены
- `bcryptjs` - Хеширование паролей (если нужно)
- `sharp` - Обработка изображений
- `multer` или `formidable` - Загрузка файлов
- `zod` - Валидация схем (уже установлен)
- `react-quill` или `slate` - Редактор форматированного текста
- `recharts` - Графики (уже установлен)

### Переменные окружения
```env
JWT_SECRET=...
JWT_EXPIRES_IN=7d
UPLOAD_MAX_SIZE=10MB
AWS_S3_BUCKET=... (для хранения файлов)
SOCIAL_VERIFICATION_ENABLED=true
```

---

## Чеклист тестирования

- [ ] Реферальная система: генерация кода, использование, вознаграждения
- [ ] Публикации в соцсетях: подача, верификация, вознаграждения
- [ ] Миссии: создание, подача, обзор, вознаграждения
- [ ] Профиль: система уровней, достижения, публикации
- [ ] Библиотека: CRUD операции, поиск, фильтры
- [ ] Подача новостей: форма, обзор, вознаграждения
- [ ] Аирдроп: распределение, отслеживание
- [ ] API: все эндпоинты, обработка ошибок
- [ ] Аутентификация: JWT, сессии, middleware
- [ ] База данных: миграции, связи, индексы

---

## Требования к документации

- Документация API (OpenAPI/Swagger)
- Документация схемы базы данных
- Формулы расчета вознаграждений
- Руководства пользователя для каждой функции
- Руководства администратора для модерации

---

## Оценочный таймлайн

**Всего: 8-10 недель** для полной реализации

- База данных и аутентификация: 1 неделя
- Реферальная система: 1 неделя
- Социальные сети: 1.5 недели
- Система миссий: 2 недели
- Профиль и библиотека: 1.5 недели
- Дорожная карта: 1 неделя
- Тестирование и полировка: 1-2 недели

---

## Примечания

- Все вознаграждения должны рассчитываться на основе токеномики
- Никаких демо-данных в продакшене
- Все API должны использовать реальные запросы к БД
- Реализовать правильную обработку ошибок и логирование
- Учитывать масштабируемость с самого начала
- Безопасность: валидация всех входных данных, предотвращение SQL-инъекций, XSS
- Производительность: оптимизация запросов, реализация кэширования
- Адаптивность для мобильных устройств для всех новых функций
